IP对全球互联网编址
路由设备将信息转发(IP => MAC),需要看下目标设备在不在子网里,如果不在,给网关,转发
IP地址和子网掩码 按位与运算 => 可以确定局域网,就直接通信(通过链路层直接完成)
不在局域网的时候,先把数据包发给路由(默认网关,它连接了多个子网),再由路由一层一层转发到目的地

IP 数据报
生存时间: 转发一次 -1 丢掉后,给源地址发一个包

DHCP(基于UDP 67) 连上子网后,可以获取IP配置信息,IP地址,子网掩码,DNS(基于UDP 53)服务器等
域名和IP的对应关系 DNS 

基于网络层的协议
    UDP协议: 端口号(源端口, 目的端口)
    广域网中,后发的先到是可能发生的
    node 中实现通信
    多播,组播,频道
    
VPN : 工作在链路层,虚拟了一个 网卡 有 mac 地址, 获取远方的 IP 地址
IPV6 的链路层不需要切换,但是路由器需要支持 IPV6    

NAT: net address translation 网络地址转换
    发出去之前,NAT 设备把源地址 改为自己的广域网 IP地址 SNAT(源地址做了转换)
    接受之后,NAT 设备把目标地址 改为内网某个设备的 IP地址 DNAT(目的地址做了转换)
    别人主动发消息给我,NAT收到后扔掉, 我收不到
    NAT套NAT BUG

ICMP: 发出去的包裹有协议,ID,通过查询ID就可以找到数据是谁的
基于IP协议,没有端口号的概念,有个 identifier
可以携带数据

UDP协议: 带有端口号 
    发送之前加了随机的端口号(动态的端口映射)
    
DDNS

UDP
upnp 需要外面的机器主动连接内网的某机器

端口转发: 某IP地址转达到另外一台机器,可以不发生在NTP里,发生在广域网

